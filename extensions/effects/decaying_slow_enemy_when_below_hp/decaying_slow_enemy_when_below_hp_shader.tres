[gd_resource type="ShaderMaterial" load_steps=2 format=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform float freeze_amount : hint_range(0.0, 1.0) = 0.5;
uniform vec4 ice_tint : hint_color = vec4(0.4, 0.7, 1.0, 1.0);

void fragment() {
    float strength = clamp(freeze_amount * 2.0, 0.0, 1.0);
    
    vec2 distorted_uv = UV;
    if (strength > 0.1) {
        distorted_uv.x += sin(TIME * 4.0 + UV.y * 10.0) * 0.005 * strength;
        distorted_uv.y += cos(TIME * 4.0 + UV.x * 10.0) * 0.005 * strength;
    }

    vec4 tex_color = texture(TEXTURE, distorted_uv);
    if (tex_color.a < 0.01) discard;

    float gray = dot(tex_color.rgb, vec3(0.299, 0.587, 0.114));
    
    vec3 final_rgb = mix(tex_color.rgb, ice_tint.rgb * gray, strength * 0.6);
    
    float sparkles = pow(sin(TIME * 2.0 + UV.x * 30.0 + UV.y * 30.0), 10.0) * strength;
    final_rgb += vec3(0.8, 0.9, 1.0) * sparkles * 0.5;

    COLOR = vec4(final_rgb, tex_color.a);
}"

[resource]
shader = SubResource( 1 )
shader_param/freeze_amount = 0.5
shader_param/ice_tint = Color( 0.3, 0.6, 1, 1 )
